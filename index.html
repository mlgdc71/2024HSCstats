<!DOCTYPE html>
<html lang="en-au">

<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>342 NSW High Schools 2024 HSC Subject Performance</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Optional: Add a subtle style for the crown emoji if needed */
        .crown-emoji {
            margin-right: 5px; /* Space between emoji and school name */
        }
    </style>
</head>
<body>
    <div class="main-content-wrapper">
        <header>
            <h1>342 NSW High Schools 2024 HSC Subject Performance</h1>
            <p>Explore school rankings of all* high schools in NSW</p>
            <p><i>*Government Schools ONLY, schools with only one or no released HSC subject data not included, PDHPE doesnt work yet :(</i></p>
        </header>

        <section class="graph-section">
            <h2 class="graph-main-title">Select a Subject to View Rankings</h2>

            <div class="subject-buttons-container" id="subjectButtons">
                </div>

            <div class="graph-container">
                <div class="y-axis-labels" id="yAxisLabels">
                    </div>
                <div class="plot-area" id="plotArea">
                    </div>
                <div class="x-axis" id="xAxis">
                    </div>
            </div>
            <p class="graph-source">Data Source: NSW Dept. of Education</p>
        </section>

        <footer>
            <p>&copy; 2024 Interactive School Subject Rankings. All rights reserved.</p>
            <p>
                <a href="https://www.linkedin.com/in/david-chen-014148277/">gateleaker</a>
            </p>
        </footer>
    </div>

    <script>
        let schoolData = [];
        let currentSubject = '';

        document.addEventListener('DOMContentLoaded', () => {
            fetch('2024data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    schoolData = data;
                    populateSubjectButtons();
                    // Set 'English Advanced' as the default subject
                    const defaultSubject = 'English Advanced';
                    if (allSubjects.includes(defaultSubject)) {
                        selectSubject(defaultSubject);
                    } else if (allSubjects.length > 0) {
                        // Fallback to the first available subject if 'English Advanced' is not found
                        selectSubject(allSubjects[0]);
                    }
                })
                .catch(error => {
                    console.error('Error fetching school data:', error);
                    // Updated to querySelector as getElementById was incorrect for graphMainTitle
                    document.querySelector('.graph-main-title').textContent = 'Error loading data. Please try again later.';
                });
        });

        // Define a list of subjects to display based on common academic subjects
        // Exclude 'ID' and 'Name' from the list of subjects
        const excludedKeys = ['ID', 'Name'];
        let allSubjects = [];

        function populateSubjectButtons() {
            const subjectButtonsContainer = document.getElementById('subjectButtons');
            subjectButtonsContainer.innerHTML = ''; // Clear existing buttons

            // Dynamically get subjects from the data, excluding 'ID' and 'Name'
            if (schoolData.length > 0) {
                allSubjects = Object.keys(schoolData[0]).filter(key => !excludedKeys.includes(key));
            }

            allSubjects.forEach(subject => {
                const button = document.createElement('button');
                button.classList.add('subject-button');
                button.textContent = subject;
                button.dataset.subject = subject;
                button.addEventListener('click', () => {
                    selectSubject(subject);
                });
                subjectButtonsContainer.appendChild(button);
            });
        }

        function selectSubject(subject) {
            currentSubject = subject;
            // Update active button state
            document.querySelectorAll('.subject-button').forEach(button => {
                button.classList.remove('active');
            });
            const selectedButton = document.querySelector(`.subject-button[data-subject="${subject}"]`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }


            document.querySelector('.graph-main-title').textContent = `Rankings for ${subject}`;
            displayGraph(subject);
        }

        function displayGraph(subject) {
            const yAxisLabelsContainer = document.getElementById('yAxisLabels');
            const plotAreaContainer = document.getElementById('plotArea');
            const xAxisContainer = document.getElementById('xAxis');

            yAxisLabelsContainer.innerHTML = '';
            plotAreaContainer.innerHTML = '';
            xAxisContainer.innerHTML = '';

            const validScores = schoolData.map(school => parseFloat(school[subject]))
                                          .filter(score => !isNaN(score) && score !== '');

            if (validScores.length === 0) {
                plotAreaContainer.innerHTML = `<p style="text-align: center; margin-top: 50px;">No data available for ${subject}.</p>`;
                return;
            }

            const minScore = Math.floor(Math.min(...validScores) / 10) * 10;
            const maxScore = Math.ceil(Math.max(...validScores) / 10) * 10;
            const scoreRange = maxScore - minScore;

            // Sort schools by score in descending order for the selected subject
            const sortedSchools = [...schoolData].filter(school => {
                const score = parseFloat(school[subject]);
                return !isNaN(score) && score !== '';
            }).sort((a, b) => {
                return parseFloat(b[subject]) - parseFloat(a[subject]);
            });

            // --- Find the highest score and its school ---
            let highestScore = -1;
            let highestScoringSchoolName = '';
            if (sortedSchools.length > 0) {
                highestScore = parseFloat(sortedSchools[0][subject]);
                highestScoringSchoolName = sortedSchools[0].Name;
            }

            const labelHeight = 30; // Height of each school name label/data point
            plotAreaContainer.style.height = `${sortedSchools.length * labelHeight}px`; // Adjust plot area height
            yAxisLabelsContainer.style.height = `${sortedSchools.length * labelHeight}px`;

            sortedSchools.forEach((school, index) => {
                const score = parseFloat(school[subject]);
                if (isNaN(score) || score === '') return;

                const topPosition = index * labelHeight + labelHeight / 2; // Center vertically within its slot

                // Y-axis Label (School Name)
                const schoolNameLabel = document.createElement('span');
                schoolNameLabel.classList.add('school-name-label');
                schoolNameLabel.style.top = `${topPosition}px`;
                schoolNameLabel.style.transform = `translateY(-50%)`;

                // Add crown emoji for the highest scoring school
                if (school.Name === highestScoringSchoolName && score === highestScore) {
                    const crown = document.createElement('span');
                    crown.classList.add('crown-emoji');
                    crown.textContent = 'ðŸ‘‘';
                    schoolNameLabel.appendChild(crown);
                }
                schoolNameLabel.appendChild(document.createTextNode(school.Name)); // Append text node for school name
                yAxisLabelsContainer.appendChild(schoolNameLabel);

                // Plot Area (Data Point)
                const dataPoint = document.createElement('div');
                dataPoint.classList.add('data-point');
                dataPoint.style.top = `${topPosition}px`; // Align with school name label
                plotAreaContainer.appendChild(dataPoint);

                const line = document.createElement('div');
                line.classList.add('line');
                const lineWidth = ((score - minScore) / scoreRange) * 100;
                line.style.width = `${lineWidth}%`;
                dataPoint.appendChild(line);

                const dot = document.createElement('div');
                dot.classList.add('dot');
                dot.style.left = `${lineWidth}%`;
                dot.style.backgroundColor = '#3498db'; /* Use a blue color for the dot */
                dataPoint.appendChild(dot);

                const scoreText = document.createElement('span');
                scoreText.classList.add('score-text');
                scoreText.textContent = score;
                scoreText.style.left = `calc(${lineWidth}% + 8px)`; // Position next to the dot
                dataPoint.appendChild(scoreText);
            });

            // X-axis Labels
            for (let i = minScore; i <= maxScore; i += 10) {
                const xLabel = document.createElement('span');
                xLabel.classList.add('x-axis-label');
                xLabel.textContent = i;
                const leftPosition = ((i - minScore) / scoreRange) * 100;
                xLabel.style.left = `${leftPosition}%`;
                xAxisContainer.appendChild(xLabel);
            }
        }
    </script>
</body>
</html>