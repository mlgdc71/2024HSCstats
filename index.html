<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>342 NSW High Schools HSC Performance</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="main-content-wrapper" id="mainContentWrapper">
        <header>
            <h1>342 NSW High Schools HSC Performance</h1>
            <p>Explore average scores for all* high schools in NSW</p>
            <p><i>*Government Schools ONLY, schools with only one or no released subject data not included, PDHPE doesnt work yet :(</i></p>
        </header>

        <section class="graph-section" id="graphSection">
            <h2 class="graph-main-title" id="graphMainTitle"></h2>
            
            <div class="subject-buttons-container" id="subjectButtonsContainer">
                </div>

            <div class="graph-container">
                <div class="y-axis-labels" id="yAxisLabels">
                    </div>
                <div class="plot-area" id="plotArea">
                    </div>
                <div class="x-axis" id="xAxis">
                    </div>
            </div>
            <p class="graph-source">Source: NSW Education department (2024 Data)</p>
        </section>

        <footer>
            <p>&copy; 2025 Your Company Name. All rights reserved.</p>
            <p>
                <a href="#">Privacy Policy</a> |
                <a href="#">Terms of Service</a> |
                <a href="#">Contact</a>
            </p>
        </footer>
    </div>

    <script>
        let allSchoolData = [];
        let availableSubjects = [];
        let currentSubject = '';

        const mainContentWrapper = document.getElementById('mainContentWrapper'); 

        const subjectButtonsContainer = document.getElementById('subjectButtonsContainer');
        const yAxisLabelsContainer = document.getElementById('yAxisLabels');
        const plotAreaContainer = document.getElementById('plotArea');
        const xAxisContainer = document.getElementById('xAxis');
        const graphMainTitle = document.getElementById('graphMainTitle');
        const graphSection = document.getElementById('graphSection'); 

        // --- Data Loading and Initialization ---
        async function loadDataAndInitialize() {
            try {
                const response = await fetch('2024data.json');
                
                if (!response.ok) {
                    console.error(`HTTP error! Status: ${response.status}, Text: ${response.statusText}`);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                allSchoolData = await response.json();

                if (allSchoolData.length > 0) {
                    availableSubjects = Object.keys(allSchoolData[0]).filter(key => key !== 'ID' && key !== 'Name');
                }

                renderSubjectButtons(); 

                if (availableSubjects.length > 0) {
                    currentSubject = 'English Advanced'; 
                    if (!availableSubjects.includes(currentSubject)) {
                        currentSubject = availableSubjects[0]; 
                    }
                    renderGraph(currentSubject); 
                } else {
                    graphMainTitle.textContent = 'No subjects found in data.';
                }

            } catch (error) {
                console.error('Error loading or processing data:', error);
                graphMainTitle.textContent = 'Error loading data. Please check console for details.';
            }
        }

        // --- Subject Button Rendering ---
        function renderSubjectButtons() {
            subjectButtonsContainer.innerHTML = ''; 

            availableSubjects.forEach(subject => {
                const button = document.createElement('button');
                button.textContent = subject;
                button.className = 'subject-button'; 
                button.dataset.subject = subject; 

                if (subject === currentSubject) {
                    button.classList.add('active');
                }

                button.addEventListener('click', () => {
                    if (currentSubject !== subject) {
                        currentSubject = subject;
                        document.querySelectorAll('.subject-button').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        renderGraph(currentSubject);
                    }
                });

                subjectButtonsContainer.appendChild(button);
            });
        }

        // --- Graph Rendering Logic ---
        function renderGraph(subject) {
            graphMainTitle.textContent = `${subject} Average Scores by School`;

            const dataForSubject = allSchoolData.filter(school => {
                const scoreValue = school[subject];
                const score = parseFloat(scoreValue);
                return scoreValue !== "" && !isNaN(score) && score >= 50 && school.Name; 
            }).map(school => ({
                name: school.Name,
                score: parseFloat(school[subject])
            })).sort((a, b) => b.score - a.score);

            let minScore = 50; 
            let maxScore = 100; 
            
            if (dataForSubject.length > 0) {
                const actualMinScore = Math.min(...dataForSubject.map(d => d.score));
                if (actualMinScore > minScore) {
                    minScore = Math.floor(actualMinScore / 5) * 5; 
                    if (minScore < 50) minScore = 50; 
                }
            }
            const scoreRange = maxScore - minScore;

            xAxisContainer.innerHTML = '';
            const numLabels = 3;
            for (let i = 0; i < numLabels; i++) {
                const labelSpan = document.createElement('span');
                const percentage = i / (numLabels - 1);
                const value = minScore + (scoreRange * percentage);
                labelSpan.textContent = value.toFixed(1);
                labelSpan.className = 'x-axis-label';
                labelSpan.style.left = `${percentage * 100}%`;
                xAxisContainer.appendChild(labelSpan);
            }

            yAxisLabelsContainer.innerHTML = '';
            plotAreaContainer.innerHTML = '';

            const rowHeight = 35; 
            plotAreaContainer.style.minHeight = `${dataForSubject.length * rowHeight}px`;
            yAxisLabelsContainer.style.minHeight = `${dataForSubject.length * rowHeight}px`;

            dataForSubject.forEach((item, index) => {
                const topPosition = index * rowHeight + (rowHeight / 2);

                const nameSpan = document.createElement('span');
                nameSpan.textContent = item.name;
                nameSpan.className = 'school-name-label';
                nameSpan.style.top = `${topPosition - 10}px`;
                nameSpan.style.transition = 'top 0.5s ease-in-out';
                yAxisLabelsContainer.appendChild(nameSpan);

                const plotWidth = plotAreaContainer.offsetWidth; 
                const clampedScore = Math.max(minScore, Math.min(maxScore, item.score));
                const dotLeft = (clampedScore - minScore) / scoreRange * plotWidth; 

                const dataPoint = document.createElement('div');
                dataPoint.className = 'data-point';
                dataPoint.style.top = `${topPosition}px`;
                dataPoint.style.transition = 'top 0.5s ease-in-out';

                const line = document.createElement('div');
                line.className = 'line';
                line.style.width = `${dotLeft}px`; 
                line.style.transition = 'width 0.5s ease-in-out';
                
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.style.left = `${dotLeft - 4}px`; 
                dot.style.transition = 'left 0.5s ease-in-out';

                const scoreText = document.createElement('span');
                scoreText.className = 'score-text';
                scoreText.textContent = item.score.toFixed(1);
                scoreText.style.left = `${dotLeft + 8}px`; 
                scoreText.style.transition = 'left 0.5s ease-in-out';

                dataPoint.appendChild(line);
                dataPoint.appendChild(dot);
                dataPoint.appendChild(scoreText);
                plotAreaContainer.appendChild(dataPoint);
            });
        }

        // --- Event Listeners and Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            loadDataAndInitialize();

            // Re-render graph on window resize to adjust positions
            window.addEventListener('resize', () => {
                if (currentSubject) {
                    renderGraph(currentSubject);
                }
            });
        });
    </script>
</body>
</html>
